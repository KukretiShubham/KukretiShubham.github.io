{{ partial "header.html" . }}

<section id=content>
  <!-- Research Category -->
  {{ $researchPosts := where (where .Site.RegularPages "Section" "blogs") "Params.categories" "intersect" (slice "Research") }}
  {{ if $researchPosts }}
  {{/* Separate pinned, regular, and archived posts */}}
  {{ $pinnedResearch := where (where $researchPosts "Params.archived" "!=" true) "Params.pinned" true }}
  {{ $unpinnedResearch := where (where $researchPosts "Params.pinned" "!=" true) "Params.archived" "!=" true }}
  {{ $archivedResearch := where $researchPosts "Params.archived" true }}
  <div class="category-section">
    <h2>Research</h2>
    <ul class=posts_listing>
      {{/* Show pinned posts first */}}
      {{ range $pinnedResearch }}
        <li>
          <h3><a href="{{ .Permalink }}">{{ .Title }}</a><span class="pinned-tag"> 路 pinned</span></h3>
          <div class=date>
            {{if not .Date.IsZero }}
              {{ .Date.Format (.Site.Params.dateform | default "January 2006") }}
            {{end}}
          </div>
        </li>
      {{ end }}
      {{/* Then show unpinned posts sorted by date */}}
      {{ range $unpinnedResearch }}
        <li>
          <h3><a href="{{ .Permalink }}">{{ .Title }}</a></h3>
          <div class=date>
            {{if not .Date.IsZero }}
              {{ .Date.Format (.Site.Params.dateform | default "January 2006") }}
            {{end}}
          </div>
        </li>
      {{ end }}
      {{/* Show archived posts last - no link, just title */}}
      {{ range $archivedResearch }}
        <li>
          <h3><span class="archived-title">{{ .Title }}</span><span class="archived-tag"> 路 archived</span></h3>
        </li>
      {{ end }}
    </ul>
  </div>
  {{ end }}
  
  <!-- Personal Category -->
  {{ $personalPosts := where (where .Site.RegularPages "Section" "blogs") "Params.categories" "intersect" (slice "Personal") }}
  {{ if $personalPosts }}
  {{/* Separate pinned, regular, and archived posts */}}
  {{ $pinnedPersonal := where (where $personalPosts "Params.archived" "!=" true) "Params.pinned" true }}
  {{ $unpinnedPersonal := where (where $personalPosts "Params.pinned" "!=" true) "Params.archived" "!=" true }}
  {{ $archivedPersonal := where $personalPosts "Params.archived" true }}
  <div class="category-section">
    <h2>Personal</h2>
    <ul class=posts_listing>
      {{/* Show pinned posts first */}}
      {{ range $pinnedPersonal }}
        <li>
          <h3><a href="{{ .Permalink }}">{{ .Title }}</a><span class="pinned-tag"> 路 pinned</span></h3>
          <div class=date>
            {{if not .Date.IsZero }}
              {{ .Date.Format (.Site.Params.dateform | default "January 2006") }}
            {{end}}
          </div>
        </li>
      {{ end }}
      {{/* Then show unpinned posts sorted by date */}}
      {{ range $unpinnedPersonal }}
        <li>
          <h3><a href="{{ .Permalink }}">{{ .Title }}</a></h3>
          <div class=date>
            {{if not .Date.IsZero }}
              {{ .Date.Format (.Site.Params.dateform | default "January 2006") }}
            {{end}}
          </div>
        </li>
      {{ end }}
      {{/* Show archived posts last - no link, just title */}}
      {{ range $archivedPersonal }}
        <li>
          <h3><span class="archived-title">{{ .Title }}</span><span class="archived-tag"> 路 archived</span></h3>
        </li>
      {{ end }}
    </ul>
  </div>
  {{ end }}
</section>

{{ partial "footer.html" . }}
